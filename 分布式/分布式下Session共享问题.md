### 分布式下Session共享问题

> 通过一个负载均衡的网关机器来做负载均衡，然后转发给对应的机器来作业务计算，这个时候带来机器间无法识别登录状态。所有要要一个机制来实现Session的共享。

##### 1.Session Sticky

​	某个用户在负载均衡的时候访问某个服务器，然后接下来的每一次访问都固定访问这个服务器。

​	这样导致了以下几个问题：

​	1.一旦sticky的那个机器gg，就导致无法访问;

​	2.负载服务器需要去读取Cookie，是应用层数据，本来转发只需要读取到应用层即可。

​	3.负载服务器变成了一个有状态的节点，因为需要**记住**哪些用户**sticky**到哪些服务器。



##### 2.Session Replication

​	直接在不同的服务器间共享。就是说ABC三台服务器，A收到一个请求的时候，会把Session共享给其他的服务器。每一个服务器都存在一个副本。

​	导致的问题：

​	1.服务器之间需要进行频繁的同步;

​	2.服务器台数上升的话会导致同步成本非常高。



##### 3.Session 数据集中储存

​	集中储存Session数据，就是说，有一台专门的服务器来储存Session数据，然后每一台应用服务器收到请求的时候，从Session服务器获取相对应的身份标识。

​	导致的问题：

​	1.获取Session数据需要网络IO操作;

​	2.Session服务器出问题会导致服务崩溃。



##### 4.Cookie Based

​	就是把所有的数据都带在Cookie上。

​	1.带宽的浪费;

​	2.数据的安全性问题，如果加密的话，加密解密又会浪费计算资源;

​	3.cookie本身由最长字段限制。



##### 5.总结

​	大型网站一般使用**Session Sticky**和**Sessoin 数据几种储存**，具体的架构选型可以根据具体的业务来选择。

